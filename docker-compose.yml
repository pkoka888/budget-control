version: '3.8'

services:
  # Budget Control Application
  budget-app:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: budget-control-app
    ports:
      - "8080:80"
    volumes:
      # Mount database directory for persistence
      - ./budget-app/database:/var/www/html/database
      # Mount uploads directory
      - ./budget-app/uploads:/var/www/html/uploads
      # Mount bank JSON import directory
      - ./user-data/bank-json:/var/www/html/user-data/bank-json
      # Development: Mount source code for live reloading (comment out in production)
      - ./budget-app/src:/var/www/html/src
      - ./budget-app/views:/var/www/html/views
      - ./budget-app/public/js:/var/www/html/public/js
    environment:
      - PHP_TIMEZONE=Europe/Prague
      - APP_ENV=production
      - APP_DEBUG=false
    restart: unless-stopped
    networks:
      - budget-network
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost/"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

  # Optional: phpMyAdmin-like tool for SQLite (for development)
  adminer:
    image: adminer:latest
    container_name: budget-control-adminer
    ports:
      - "8081:8080"
    environment:
      - ADMINER_DEFAULT_SERVER=budget-app
    networks:
      - budget-network
    profiles:
      - dev
    restart: unless-stopped

networks:
  budget-network:
    driver: bridge

volumes:
  # Named volumes for data persistence
  database-data:
  uploads-data:
